<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calculadora de Logaritmos (M√©todo de Tablas)</title>
    <style>
        * {
            box-sizing: border-box;
        }
        :root{
            --bg: linear-gradient(135deg, #f5f7ff 0%, #e8ecff 50%, #f0f4ff 100%);
            --card-bg: #fff;
            --accent: #5844dd;
            --accent-2: #2dd4bf;
            --accent-3: #f97316;
            --text: #1e293b;
            --text-light: #64748b;
            --border: #e2e8f0;
            --shadow: 0 4px 20px rgba(0,0,0,0.08);
            --shadow-lg: 0 12px 40px rgba(0,0,0,0.12);
        }
        body {
            font-family: 'Montserrat', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: var(--bg);
            min-height: 100vh;
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: flex-start;
            transition: background 0.3s, color 0.3s;
        }
        .container {
            background: var(--card-bg);
            padding: 3rem 2.5rem;
            border-radius: 20px;
            box-shadow: var(--shadow-lg);
            border: 1px solid var(--border);
            width: 100%;
            max-width: 620px;
            margin-top: 2.5rem;
            margin-bottom: 3rem;
            animation: slideDown 0.6s cubic-bezier(0.34, 1.56, 0.64, 1);
        }
        @keyframes slideDown {
            from { opacity: 0; transform: translateY(-40px); }
            to { opacity: 1; transform: translateY(0); }
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }
        h1 {
            color: var(--text);
            text-align: center;
            font-size: 2.4rem;
            margin-bottom: 0.3rem;
            font-weight: 900;
            letter-spacing: 0.5px;
            background: linear-gradient(135deg, var(--accent), var(--accent-2));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        .subtitle {
            text-align: center;
            color: var(--accent-2);
            font-size: 1.1rem;
            margin-bottom: 2.5rem;
            font-style: normal;
            font-weight: 600;
            letter-spacing: 0.3px;
        }
        .input-group {
            margin-bottom: 1.7rem;
        }
        label {
            display: block;
            margin-bottom: 0.7rem;
            color: var(--text);
            font-weight: 700;
            font-size: 1rem;
        }
        input {
            width: 100%;
            padding: 13px 16px;
            font-size: 1.08rem;
            border: 2px solid var(--border);
            border-radius: 10px;
            transition: border-color 0.3s cubic-bezier(0.34, 1.56, 0.64, 1), box-shadow 0.3s, background 0.2s;
            background: var(--card-bg);
            color: var(--text);
            font-weight: 500;
        }
        input:focus {
            outline: none;
            border-color: var(--accent);
            box-shadow: 0 0 0 4px rgba(88, 68, 221, 0.15);
        }
        input::placeholder {
            color: rgba(0,0,0,0.3);
        }
        body.dark input::placeholder {
            color: rgba(255,255,255,0.3);
        }
        button {
            width: 100%;
            padding: 15px;
            background: linear-gradient(120deg, var(--accent) 0%, var(--accent-2) 100%);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 1.15rem;
            font-weight: 700;
            cursor: pointer;
            transition: transform 0.2s cubic-bezier(0.34, 1.56, 0.64, 1), box-shadow 0.3s ease, letter-spacing 0.2s;
            box-shadow: var(--shadow);
            letter-spacing: 0.5px;
        }
        button:hover {
            transform: translateY(-3px);
            box-shadow: 0 12px 28px rgba(88, 68, 221, 0.25);
            letter-spacing: 1px;
        }
        button:active {
            transform: translateY(-1px);
        }
        #result-area {
            margin-top: 2.2rem;
            display: none;
            border-top: 2px solid #e0e7ff;
            padding-top: 2rem;
            animation: fadeIn 0.5s ease-out;
        }
        .step-box {
            background: linear-gradient(135deg, #f8f9ff 0%, #f3f4f6 100%);
            border-left: 5px solid var(--accent);
            padding: 16px 16px;
            margin-bottom: 14px;
            font-size: 1.02rem;
            border-radius: 10px;
            line-height: 1.8;
            box-shadow: var(--shadow);
            transition: transform 0.3s, box-shadow 0.3s;
        }
        .step-box:hover {
            transform: translateX(2px);
            box-shadow: 0 6px 28px rgba(0,0,0,0.12);
        }
        .step-title {
            font-weight: 800;
            color: var(--text);
            display: block;
            margin-bottom: 10px;
            font-size: 1.12rem;
            letter-spacing: 0.3px;
        }
        .final-result {
            text-align: center;
            background: linear-gradient(135deg, #e0f7fa 0%, #f0f4ff 100%);
            border: 2px solid var(--accent-2);
            padding: 28px 16px 24px 16px;
            border-radius: 16px;
            margin-top: 2.5rem;
            box-shadow: var(--shadow);
            transition: transform 0.3s, box-shadow 0.3s;
        }
        .final-result:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 32px rgba(45, 212, 191, 0.2);
        }
        .result-label {
            font-size: 1.01rem;
            color: #3b3b5c;
            margin-bottom: 10px;
            font-weight: 700;
        }
        .big-number {
            font-size: 3rem;
            font-weight: 900;
            color: var(--accent);
            font-family: 'Courier New', Courier, monospace;
            letter-spacing: 3px;
            margin: 20px 0;
            text-shadow: 0 4px 15px rgba(88, 68, 221, 0.15);
            animation: scaleIn 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
        }
        @keyframes scaleIn {
            from { opacity: 0; transform: scale(0.9); }
            to { opacity: 1; transform: scale(1); }
        }
        .bar-notation {
            text-decoration: overline;
            text-decoration-thickness: 2px;
            text-underline-offset: 3px;
        }
        .decimal-result {
            margin-top: 15px;
            font-size: 1.01rem;
            color: #3b3b5c;
            border-top: 1px dashed #48c6ef;
            padding-top: 12px;
        }
        .decimal-value {
            font-weight: bold;
            color: #3b3b5c;
            font-family: 'Courier New', Courier, monospace;
            font-size: 1.15rem;
        }
        .note {
            font-size: 0.95rem;
            color: #6c63ff;
            text-align: center;
            margin-top: 15px;
            padding: 10px;
            background-color: #f8fafc;
            border-radius: 7px;
            border-left: 4px solid #48c6ef;
        }
        .info-box {
            background-color: #fff3cd;
            border-left: 5px solid #ffc107;
            padding: 13px 12px;
            margin-top: 15px;
            border-radius: 7px;
            font-size: 0.97rem;
            color: #856404;
            box-shadow: 0 2px 8px rgba(255,193,7,0.07);
        }
        /* Dark mode */
        body.dark {
            --bg: linear-gradient(135deg, #0f172a 0%, #1a1f35 50%, #16213e 100%);
            --card-bg: #0f172a;
            --accent: #a78bfa;
            --accent-2: #2dd4bf;
            --accent-3: #fb923c;
            --text: #f1f5f9;
            --text-light: #cbd5e1;
            --border: #334155;
        }
        body.dark .container { box-shadow: var(--shadow-lg); border: 1px solid var(--border); }
        body.dark .step-box { background: linear-gradient(90deg, #1e293b 0%, #1a1f35 100%); border-left-color: var(--accent); box-shadow: none; border: 1px solid var(--border); }
        body.dark input { background: #1a1f35; border-color: var(--border); color:var(--text); }
        body.dark .procedure-area { background: #1e293b; border-left-color: var(--accent-2); border: 1px solid var(--border); }
        body.dark .final-result { background: linear-gradient(120deg, #1e293b 0%, #1a1f35 100%); border-color: var(--accent-2); box-shadow: none; border: 1px solid var(--border); }
        body.dark .big-number { color: var(--accent); text-shadow: 0 0 20px rgba(167,139,250,0.3); }
        body.dark .table-container { background: #1e293b; border: 1px solid var(--border); }
        body.dark .table-row-highlight { background: linear-gradient(90deg, #2dd4bf, #2dd4bf) !important; color: #0f172a !important; }
        .show-procedure {
            display: flex;
            align-items: center;
            gap: 8px;
            margin: 18px 0 0 0;
        }
        .show-procedure input[type="checkbox"] {
            accent-color: #6c63ff;
            width: 20px;
            height: 20px;
        }
        .procedure-area {
            margin-top: 18px;
            background: linear-gradient(135deg, #f8f9ff 0%, #f3f4f6 100%);
            border-radius: 12px;
            padding: 18px 16px;
            box-shadow: var(--shadow);
            border-left: 5px solid var(--accent-2);
            border: 1px solid var(--border);
            font-size: 1.02rem;
            color: var(--text);
            line-height: 1.8;
        }
        .table-container {
            margin-top: 20px;
            background: #f8f9fa;
            border-radius: 12px;
            padding: 16px;
            border: 1px solid var(--border);
            box-shadow: var(--shadow);
            max-height: 400px;
            overflow-y: auto;
            font-family: 'Courier New', monospace;
        }
        .table-container table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.95rem;
        }
        .table-container th {
            background: linear-gradient(135deg, var(--accent), var(--accent-2));
            color: white;
            padding: 10px 8px;
            text-align: center;
            font-weight: 700;
            position: sticky;
            top: 0;
            z-index: 10;
        }
        .table-container td {
            padding: 8px 10px;
            text-align: center;
            border-bottom: 1px solid rgba(0,0,0,0.04);
            color: var(--text);
        }
        .table-container tr:hover {
            background: rgba(88,68,221,0.08);
        }
        .table-row-highlight {
            background: linear-gradient(90deg, var(--accent-2), rgba(45,212,191,0.5)) !important;
            color: var(--text) !important;
            font-weight: 700;
            box-shadow: inset 0 0 0 2px var(--accent-2);
        }
        .note {
            margin-top: 20px;
            padding: 14px 16px;
            background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
            border-radius: 10px;
            border-left: 5px solid #f59e0b;
            border: 1px solid rgba(245,158,11,0.3);
            color: #78350f;
            font-size: 0.98rem;
            box-shadow: 0 2px 6px rgba(245,158,11,0.1);
        }
        .info-box {
            margin-top: 16px;
            padding: 12px 14px;
            background: linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%);
            border-radius: 10px;
            border-left: 5px solid #3b82f6;
            border: 1px solid rgba(59,130,246,0.3);
            color: #1e3a8a;
            font-size: 0.96rem;
            box-shadow: 0 2px 6px rgba(59,130,246,0.1);
        }
        .show-procedure {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-top: 16px;
            cursor: pointer;
        }
        .show-procedure input[type="checkbox"] {
            width: 20px;
            height: 20px;
            cursor: pointer;
            accent-color: var(--accent);
        }
        .show-procedure label {
            cursor: pointer;
            color: var(--text);
            font-size: 1.01rem;
            font-weight: 500;
        }
        body.dark .note {
            background: linear-gradient(135deg, #7c2d12 0%, #9a3412 100%);
            border-left-color: #fb923c;
            border-color: rgba(251,146,60,0.2);
            color: #fed7aa;
        }
        body.dark .info-box {
            background: linear-gradient(135deg, #0c4a6e 0%, #164e63 100%);
            border-left-color: #0ea5e9;
            border-color: rgba(14,165,233,0.2);
            color: #cffafe;
        }
        body.dark .table-container {
            background: #1a1f35;
            border-color: var(--border);
        }
        body.dark .table-container td {
            color: #cbd5e1;
            border-bottom-color: rgba(148,163,184,0.1);
        }
        body.dark .table-container tr:hover {
            background: rgba(167,139,250,0.1);
        }
        body.dark .procedure-area {
            background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%);
            border-left-color: var(--accent-2);
            border-color: var(--border);
        }
        input[type="radio"],
        #darkMode {
            width: auto;
            padding: 0;
            border: none;
            margin-right: 6px;
            cursor: pointer;
            accent-color: var(--accent);
            width: 18px;
            height: 18px;
        }
        input[type="radio"]:hover,
        #darkMode:hover {
            filter: brightness(1.1);
        }
        input[type="radio"]:focus,
        #darkMode:focus {
            outline: 2px solid var(--accent);
            outline-offset: 2px;
        }
        @media (max-width: 600px) {
            .container {
                padding: 2rem 1.5rem;
                border-radius: 16px;
                margin-top: 1rem;
                margin-bottom: 2rem;
            }
            h1 {
                font-size: 1.8rem;
            }
            button {
                font-size: 1rem;
                padding: 12px;
            }
            .big-number {
                font-size: 2rem;
            }
            input {
                font-size: 1rem;
                padding: 12px 14px;
            }
            .table-container {
                max-height: 300px;
            }
        }
        /* Procedural example styles (mini table used in procedure area) */
        .procedure-example {
            margin-top: 8px;
            padding: 12px;
            border-radius: 10px;
            background: var(--card-bg);
            border: 1px solid var(--border);
            box-shadow: var(--shadow);
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        .procedure-example-title {
            font-weight: 700;
            color: var(--accent);
            font-size: 0.95rem;
        }
        .procedure-example-table {
            width: 100%;
            border-collapse: collapse;
            font-family: 'Courier New', monospace;
            font-size: 0.95rem;
        }
        .procedure-example-table th {
            padding: 8px 6px;
            text-align: center;
            color: #fff;
            background: linear-gradient(90deg, var(--accent), var(--accent-2));
            font-weight: 700;
        }
        .procedure-example-table td {
            padding: 8px 6px;
            text-align: center;
            border-bottom: 1px solid rgba(0,0,0,0.04);
            color: var(--text);
        }
        .procedure-row-highlight {
            background: linear-gradient(90deg, var(--accent), var(--accent-2));
            color: #fff;
            font-weight: 700;
            box-shadow: inset 0 0 0 2px rgba(255,255,255,0.03);
        }
        .procedure-example .example-legend {
            font-size: 0.92rem;
            color: var(--text-light);
            display:flex;
            justify-content:space-between;
            align-items:center;
            gap: 10px;
        }
        body.dark .procedure-example {
            background: linear-gradient(135deg,#0f172a 0%, #111827 100%);
            border-color: rgba(255,255,255,0.04);
        }
        body.dark .procedure-example-table td { color: #cbd5e1; }
        body.dark .procedure-row-highlight { box-shadow: inset 0 0 0 2px rgba(255,255,255,0.06); }
        /* Utility: visually hidden for screen-readers */
        .visually-hidden { position: absolute !important; width: 1px; height: 1px; padding: 0; margin: -1px; overflow: hidden; clip: rect(0 0 0 0); white-space: nowrap; border: 0; }
    </style>
</head>
<body>

<div class="container">
    <h1>üßÆ Calculadora de Logaritmos</h1>
    <p class="subtitle">M√©todo de Tablas (Base 10)</p>
    
    <div class="input-group">
        <label for="numberInput">Ingresa un n√∫mero (N > 0):</label>
        <span style="display:block;font-size:0.95em;color:var(--text-light);margin-bottom:0.5em;">Ejemplo: 0.001349, 134.9, 5, 0.5, 1000</span>
        <input type="number" id="numberInput" placeholder="Ej: 0.001349 o 134.9" step="any" min="0" max="1e308">
        <div class="show-procedure">
            <input type="checkbox" id="showProcedure">
            <label for="showProcedure" style="margin:0; font-weight:600; color:var(--accent); cursor:pointer;">üìã Mostrar procedimiento manual de tabla</label>
        </div>
    </div>
    
    <div style="display:flex;gap:16px;margin-bottom:14px;align-items:center;flex-wrap:wrap;">
        <div style="display:flex;gap:10px;align-items:center;">
            <label style="display:flex;align-items:center;gap:6px;font-weight:700;color:var(--text);margin:0;">Modo:</label>
            <label style="cursor:pointer;display:flex;align-items:center;gap:6px;color:var(--text);">
                <input type="radio" name="mode" value="log" checked> Logaritmo
            </label>
            <label style="cursor:pointer;display:flex;align-items:center;gap:6px;color:var(--text);">
                <input type="radio" name="mode" value="antilog"> Antilogaritmo
            </label>
        </div>
        <div style="margin-left:auto;display:flex;align-items:center;gap:10px;">
            <label for="darkMode" style="font-weight:600;color:var(--text);margin:0;cursor:pointer;display:flex;align-items:center;gap:6px;">
                üåô Modo nocturno
            </label>
            <input type="checkbox" id="darkMode">
        </div>
    </div>

    <button onclick="calculateLog()" id="computeBtn">Calcular y Explicar</button>
    <span style="display:block;text-align:center;color:#48c6ef;font-size:0.98em;margin-top:0.7em;">Presiona <b>Enter</b> para calcular r√°pidamente</span>

    <div id="result-area">
        <div class="step-box" aria-live="polite">
            <span class="step-title">üìç Paso 1: Calcular la Caracter√≠stica (Parte Entera)</span>
            <div id="step1-text"></div>
        </div>

        <div class="step-box" aria-live="polite">
            <span class="step-title">üìä Paso 2: Obtener la Mantisa (Buscar en la Tabla)</span>
            <div id="step2-text"></div>
        </div>

        <div id="procedure-area" class="procedure-area" style="display:none;"></div>

        <div class="step-box" style="margin-top:12px;">
            <span class="step-title">üîé Simulaci√≥n de Tabla (4 d√≠gitos)</span>
            <div id="table-sim" style="font-family:'Courier New',monospace; font-size:0.98rem; color:var(--text); margin-top:12px;">
                üìù Ingresa un n√∫mero para ver la simulaci√≥n de la tabla de logaritmos.
            </div>
        </div>

        <div class="final-result">
            <div class="result-label">Resultado Final - Notaci√≥n Acad√©mica de Tabla</div>
            <div class="big-number" id="final-display" aria-label="Resultado en notaci√≥n de tabla"></div>
            <div class="decimal-result">
                Equivalente en notaci√≥n decimal: <span class="decimal-value" id="decimal-display" aria-label="Resultado decimal"></span>
            </div>
        </div>
        
        <p class="note">
            üí° <strong>Nota:</strong> La mantisa se calcula matem√°ticamente para simular el resultado de consultar una tabla de logaritmos est√°ndar.
        </p>
        
        <div class="info-box">
            <strong>‚ÑπÔ∏è ¬øC√≥mo se lee?</strong><br>
            <span style="color:#6c63ff;font-weight:bold;">Si ves <span style="text-decoration:overline">3</span>.1300</span> significa: Caracter√≠stica -3, Mantisa .1300<br>
            <span style="color:#48c6ef;font-weight:bold;">Si ves 2.1300</span> significa: Caracter√≠stica 2, Mantisa .1300<br>
            <span style="color:#888;font-size:0.95em;">La barra sobre el n√∫mero indica que la caracter√≠stica es negativa (notaci√≥n de tabla).</span>
        </div>
    </div>
</div>

<script>
    function createProcedureExampleHTML(sigDigits, key, mantissaStr) {
        // genera un peque√±o bloque HTML (mini-tabla) que simula una tabla de logaritmos
        try {
            const rows = [];
            for (let delta = -2; delta <= 2; delta++) {
                const k = key + delta;
                if (k < 1000) continue; // tabla de 4 d√≠gitos
                const s = String(k).padStart(4, '0');
                const nval = Number(s[0] + '.' + s.substring(1));
                const mant = Math.log10(nval).toFixed(4).substring(1);
                rows.push({k: s, mant});
            }

            const legendId = 'proc-legend-' + String(sigDigits).replace(/\s+/g,'-');
            let html = `<div class="procedure-example" role="img" tabindex="0" aria-describedby="${legendId}" aria-label="Mini tabla de logaritmos con fila ${sigDigits} resaltada">`;
            html += `<div class="procedure-example-title">Mini tabla ‚Äî 4 d√≠gitos (ejemplo)</div>`;
            html += `<table class="procedure-example-table" role="table" aria-hidden="false"><thead><tr><th>Fila</th><th>Mantisa</th></tr></thead><tbody>`;
            if (rows.length === 0) {
                // fallback sample: 1000..1004
                for (let i = 1000; i <= 1004; i++) {
                    const s = String(i).padStart(4,'0');
                    const nval = Number(s[0] + '.' + s.substring(1));
                    const mant = Math.log10(nval).toFixed(4).substring(1);
                    rows.push({k: s, mant});
                }
            }

            rows.forEach(r => {
                const isKey = r.k === String(sigDigits).padStart(4, '0');
                html += `<tr ${isKey ? 'class="procedure-row-highlight"' : ''}><td>${r.k}</td><td>${r.mant}</td></tr>`;
            });
            html += `</tbody></table>`;
            html += `<div id="${legendId}" class="example-legend"><div>Fila resaltada: <strong>${sigDigits}</strong></div><div>Mantisa: <strong style="color:var(--accent)">${mantissaStr}</strong></div></div>`;
            html += `<div class="visually-hidden">Mini tabla de ejemplo: filas ${rows.map(r=>r.k).join(', ')} con la fila ${sigDigits} resaltada que contiene la mantisa ${mantissaStr}.</div>`;
            html += `</div>`;
            return html;
        } catch (e) {
            return `<div style="color:var(--text)">Ejemplo no disponible.</div>`;
        }
    }

    function calculateLog() {
        const input = document.getElementById('numberInput').value.trim();
        const mode = document.querySelector('input[name="mode"]:checked').value;
        const n = parseFloat(input);
        const resultArea = document.getElementById('result-area');
        const showProcedure = document.getElementById('showProcedure').checked;
        const procedureArea = document.getElementById('procedure-area');
        const tableSim = document.getElementById('table-sim');

        // Validaci√≥n de entrada
        if (isNaN(n) || n <= 0) {
            alert("Por favor ingresa un n√∫mero positivo mayor que 0.");
            resultArea.style.display = 'none';
            procedureArea.style.display = 'none';
            return;
        }

        // Si estamos en modo 'antilog', la entrada es un logaritmo (valor L)
        let modeLabel = 'Logaritmo';
        if (mode === 'antilog') {
            modeLabel = 'Antilogaritmo';
        }

        let logValue, characteristic, explanation = "", zerosCount = 0;

        if (mode === 'log') {
            // C√°lculo matem√°tico real del logaritmo base 10 a partir del n√∫mero
            logValue = Math.log10(n);

            // PASO 1: CALCULAR LA CARACTER√çSTICA CON REGLAS ESTRICTAS
            if (n >= 1) {
                // Regla 1: Para n√∫meros >= 1
                let integerPartStr = String(Math.floor(n));
                let numDigits;
                // Manejar notaci√≥n cient√≠fica en la entrada (ej. 1.23e5)
                if (/e/i.test(input)) {
                    const m = input.match(/([0-9]+(?:\.[0-9]+)?)e([+-]?\d+)/i);
                    if (m) {
                        const sig = m[1];
                        const exp = parseInt(m[2], 10);
                        const intPartOfSig = sig.split('.')[0];
                        numDigits = Math.abs(exp) + intPartOfSig.replace(/^0+/, '').length;
                        integerPartStr = (sig.replace('.', '') + 'e' + exp); // mostrar aproximaci√≥n
                    } else {
                        numDigits = integerPartStr.length;
                    }
                } else {
                    numDigits = integerPartStr.length;
                }
                characteristic = numDigits - 1;
                explanation = `El n√∫mero es <b>mayor o igual a 1</b>.<br>
                              La parte entera tiene <b>${numDigits}</b> d√≠gito(s): <b>${integerPartStr}</b>.<br>
                              F√≥rmula: D√≠gitos - 1 = ${numDigits} - 1 = <b>${characteristic}</b>`;
            } else {
                // Regla 2: Para n√∫meros < 1
                const strNumber = input.toString();
                // Manejar notaci√≥n cient√≠fica (ej: 1.349e-3)
                if (/e/i.test(strNumber)) {
                    const m = strNumber.match(/([0-9]+(?:\.[0-9]+)?)e([+-]?\d+)/i);
                    if (m) {
                        const exp = parseInt(m[2], 10);
                        if (exp < 0) {
                            // Por ejemplo 1.349e-3 -> zerosCount = |exp| - 1
                            zerosCount = Math.abs(exp) - 1;
                        }
                    }
                } else {
                    const parts = strNumber.split('.');
                    if (parts.length === 2) {
                        // Contar los ceros despu√©s del punto hasta la primera cifra significativa
                        const decimalPart = parts[1];
                        for (let i = 0; i < decimalPart.length; i++) {
                            if (decimalPart[i] === '0') {
                                zerosCount++;
                            } else {
                                break;
                            }
                        }
                    }
                }
                characteristic = -(zerosCount + 1);
                explanation = `El n√∫mero es <b>menor que 1</b>.<br>
                              Despu√©s del punto hay <b>${zerosCount}</b> cero(s) antes de la primera cifra significativa.<br>
                              F√≥rmula: -(Ceros + 1) = -(${zerosCount} + 1) = <b>${characteristic}</b><br>
                              Notaci√≥n de tabla: Se escribe como <span style="text-decoration:overline">${Math.abs(characteristic)}</span>`;
            }
        } else {
            // Modo antilog: la entrada es el valor del logaritmo L
            const L = parseFloat(input);
            if (isNaN(L)) {
                alert('Por favor ingresa un valor num√©rico para el antilogaritmo.');
                resultArea.style.display = 'none';
                procedureArea.style.display = 'none';
                tableSim.innerText = '';
                return;
            }
            logValue = L;
            // Para antilog, la caracter√≠stica es la parte entera (floor)
            characteristic = Math.floor(L);
            const mant = +( (L - characteristic).toFixed(6) );
            // Calcular el n√∫mero original
            const N = Math.pow(10, L);
            explanation = `Modo: <b>Antilogaritmo</b>.<br>Se separa el logaritmo en caracter√≠stica = <b>${characteristic}</b> y mantisa = <b>${mant.toFixed(6)}</b>.<br>El n√∫mero original es: <b>N = 10<sup>${L}</sup> = ${N.toPrecision(8)}</b>`;
        }

        // PASO 2: CALCULAR LA MANTISA
        // La mantisa SIEMPRE es positiva: mantisa = logTotal - caracter√≠stica
        const mantissa = +(logValue - characteristic);
        const mantissaFormatted = mantissa.toFixed(4);
        const mantissaString = mantissaFormatted.substring(1); // ".XXXX" formato

        // Extraer d√≠gitos significativos para explicaci√≥n
        let strN;
        if (mode === 'antilog') {
            // Para antilog, usar el n√∫mero reconstruido
            strN = Math.pow(10, logValue).toString().replace('.', '').replace(/^0+/, '');
        } else {
            strN = input.toString().replace('.', '').replace(/^0+/, '');
        }
        let significantDigits = strN.substring(0, 4);
        significantDigits = significantDigits.padEnd(4, '0');

        // PASO 3: GENERAR VISUALIZACI√ìN

        // Explicaci√≥n Paso 1
        document.getElementById('step1-text').innerHTML = explanation;

        // Explicaci√≥n Paso 2
        if (mode === 'antilog') {
            document.getElementById('step2-text').innerHTML = `
                Para reconstruir el n√∫mero, usamos la caracter√≠stica y mantisa:<br>
                <b>N = 10<sup>${characteristic} + ${mantissaString}</sup> = ${Math.pow(10, logValue).toPrecision(8)}</b><br>
                <span style="font-size: 0.85rem; color: #555;">Matem√°ticamente: 10<sup>${logValue.toFixed(6)}</sup> = ${Math.pow(10, logValue).toPrecision(8)}</span>`;
        } else {
            document.getElementById('step2-text').innerHTML = `
                Para encontrar la mantisa, buscamos los d√≠gitos significativos: <b>${significantDigits}</b> en una tabla de logaritmos.<br>
                La mantisa (siempre positiva) es: <b>${mantissaString}</b><br>
                <span style="font-size: 0.85rem; color: #555;">Matem√°ticamente: log(${n}) - ${characteristic} = ${logValue.toFixed(6)} - ${characteristic} = ${mantissa.toFixed(6)}</span>`;
        }

        // Resultado final en notaci√≥n de tabla
        let finalDisplay = "";
        if (mode === 'antilog') {
            // Mostrar el n√∫mero reconstruido y la notaci√≥n
            finalDisplay = `<span style="font-size:1.15em;font-weight:700;color:var(--accent)">${Math.pow(10, logValue).toPrecision(8)}</span> <span style="font-size:0.95em;color:var(--text-light)">(N = 10<sup>${logValue.toFixed(4)}</sup>)</span>`;
        } else {
            if (characteristic < 0) {
                finalDisplay = `<span class="bar-notation">${Math.abs(characteristic)}</span>${mantissaString}`;
            } else {
                finalDisplay = `${characteristic}${mantissaString}`;
            }
        }
        document.getElementById('final-display').innerHTML = finalDisplay;

        // Resultado en notaci√≥n decimal (conversi√≥n est√°ndar)
        if (mode === 'antilog') {
            document.getElementById('decimal-display').innerText = Math.pow(10, logValue).toPrecision(8);
        } else {
            const decimalNotation = logValue.toFixed(4);
            document.getElementById('decimal-display').innerText = decimalNotation;
        }

        // Mostrar procedimiento manual si el usuario lo solicita
        if (showProcedure) {
            let procedureHTML = `<b>Simulaci√≥n de consulta en tabla de logaritmos:</b><br><br>`;
            procedureHTML += `1Ô∏è‚É£ <b>Identifica los d√≠gitos significativos:</b> <span style='color:var(--accent);font-weight:bold;'>${significantDigits}</span><br>`;
            procedureHTML += `2Ô∏è‚É£ <b>Busca la fila correspondiente en la tabla:</b> <span style='background:var(--accent-2);color:#fff;padding:2px 6px;border-radius:4px;'>${significantDigits}</span><br>`;
            procedureHTML += `3Ô∏è‚É£ <b>Lee la mantisa en la tabla:</b> <span style='color:var(--accent);font-weight:bold;'>${mantissaString}</span> <span style='font-size:0.95em;color:var(--muted);'>(simulada matem√°ticamente)</span><br>`;
            procedureHTML += `<br>üìö <i>En una tabla real, buscar√≠as la secuencia <b>${significantDigits}</b> en la columna de la tabla y copiar√≠as el valor de la mantisa correspondiente.</i><br>`;
            procedureHTML += `<br>üîé <b>Ejemplo visual:</b><br>` + createProcedureExampleHTML(significantDigits, parseInt(significantDigits,10), mantissaString);
            procedureArea.innerHTML = procedureHTML;
            procedureArea.style.display = 'block';
        } else {
            procedureArea.style.display = 'none';
        }

        resultArea.style.display = 'block';

        // Simulaci√≥n de tabla: generar filas cercanas y resaltar
        try {
            // construir n√∫mero normalizado a partir de significantDigits: d1.d234
            const d1 = significantDigits[0];
            const normalized = Number(d1 + '.' + significantDigits.substring(1));
            const rows = [];
            const key = parseInt(significantDigits, 10);
            for (let delta = -2; delta <= 2; delta++) {
                const k = key + delta;
                if (k < 1000) continue;
                const s = String(k).padStart(4, '0');
                const nval = Number(s[0] + '.' + s.substring(1));
                const mant = Math.log10(nval).toFixed(4).substring(1);
                rows.push({k: s, mant});
            }
            let tableHTML = '<table style="width:100%;border-collapse:collapse;font-size:0.95rem;">';
            for (const r of rows) {
                const highlight = (r.k === String(key)) ? 'background:linear-gradient(90deg,var(--accent),var(--accent-2));color:#fff;font-weight:700;' : 'background:transparent;';
                tableHTML += `<tr style="height:34px;${highlight}"><td style="padding:6px 8px;border-bottom:1px solid rgba(0,0,0,0.04);width:60px">${r.k}</td><td style="padding:6px 8px;border-bottom:1px solid rgba(0,0,0,0.04);">${r.mant}</td></tr>`;
            }
            tableHTML += '</table>';
            tableSim.innerHTML = tableHTML;
        } catch (e) {
            tableSim.innerText = 'No se pudo simular la tabla.';
        }
    }

    // Permitir calcular presionando Enter y mostrar procedimiento al cambiar el checkbox
    document.addEventListener('DOMContentLoaded', function() {
        // Usar keydown para detectar Enter de forma fiable
        document.getElementById('numberInput').addEventListener('keydown', function(event) {
            if (event.key === 'Enter') {
                event.preventDefault();
                calculateLog();
            }
        });
        document.getElementById('showProcedure').addEventListener('change', function() {
            // Recalcular para actualizar el √°rea de procedimiento si est√° visible
            calculateLog();
        });
        document.getElementById('darkMode').addEventListener('change', function(e){
            if (this.checked) document.body.classList.add('dark'); else document.body.classList.remove('dark');
        });
        // Cambiar modo recalcula para actualizar etiquetas
        document.querySelectorAll('input[name="mode"]').forEach(r => r.addEventListener('change', ()=> calculateLog()));
    });
</script>

</body>
</html>