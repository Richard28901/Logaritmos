<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calculadora de Logaritmos y Antilogaritmos</title>
    <style>
        * {
            box-sizing: border-box;
        }
        :root{
            --bg: linear-gradient(135deg, #f5f7ff 0%, #e8ecff 50%, #f0f4ff 100%);
            --card-bg: #fff;
            --accent: #5844dd;
            --accent-2: #2dd4bf;
            --accent-3: #f97316;
            --text: #1e293b;
            --text-light: #64748b;
            --border: #e2e8f0;
            --shadow: 0 4px 20px rgba(0,0,0,0.08);
            --shadow-lg: 0 12px 40px rgba(0,0,0,0.12);
        }
        body {
            font-family: 'Montserrat', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: var(--bg);
            min-height: 100vh;
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: flex-start;
            transition: background 0.3s, color 0.3s;
        }
        .container {
            background: var(--card-bg);
            padding: 3rem 2.5rem;
            border-radius: 20px;
            box-shadow: var(--shadow-lg);
            border: 1px solid var(--border);
            width: 100%;
            max-width: 620px;
            margin-top: 2.5rem;
            margin-bottom: 3rem;
            animation: slideDown 0.6s cubic-bezier(0.34, 1.56, 0.64, 1);
        }
        @keyframes slideDown {
            from { opacity: 0; transform: translateY(-40px); }
            to { opacity: 1; transform: translateY(0); }
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }
        h1 {
            color: var(--text);
            text-align: center;
            font-size: 2.4rem;
            margin-bottom: 0.3rem;
            font-weight: 900;
            letter-spacing: 0.5px;
            background: linear-gradient(135deg, var(--accent), var(--accent-2));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        .subtitle {
            text-align: center;
            color: var(--accent-2);
            font-size: 1.1rem;
            margin-bottom: 2.5rem;
            font-style: normal;
            font-weight: 600;
            letter-spacing: 0.3px;
        }
        .input-group {
            margin-bottom: 1.7rem;
        }
        label {
            display: block;
            margin-bottom: 0.7rem;
            color: var(--text);
            font-weight: 700;
            font-size: 1rem;
        }
        input {
            width: 100%;
            padding: 13px 16px;
            font-size: 1.08rem;
            border: 2px solid var(--border);
            border-radius: 10px;
            transition: border-color 0.3s cubic-bezier(0.34, 1.56, 0.64, 1), box-shadow 0.3s, background 0.2s;
            background: var(--card-bg);
            color: var(--text);
            font-weight: 500;
        }
        input:focus {
            outline: none;
            border-color: var(--accent);
            box-shadow: 0 0 0 4px rgba(88, 68, 221, 0.15);
        }
        input::placeholder {
            color: rgba(0,0,0,0.3);
        }
        body.dark input::placeholder {
            color: rgba(255,255,255,0.3);
        }
        button {
            width: 100%;
            padding: 15px;
            background: linear-gradient(120deg, var(--accent) 0%, var(--accent-2) 100%);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 1.15rem;
            font-weight: 700;
            cursor: pointer;
            transition: transform 0.2s cubic-bezier(0.34, 1.56, 0.64, 1), box-shadow 0.3s ease, letter-spacing 0.2s;
            box-shadow: var(--shadow);
            letter-spacing: 0.5px;
        }
        button:hover {
            transform: translateY(-3px);
            box-shadow: 0 12px 28px rgba(88, 68, 221, 0.25);
            letter-spacing: 1px;
        }
        button:active {
            transform: translateY(-1px);
        }
        #result-area {
            margin-top: 2.2rem;
            display: none;
            border-top: 2px solid #e0e7ff;
            padding-top: 2rem;
            animation: fadeIn 0.5s ease-out;
        }
        .step-box {
            background: linear-gradient(135deg, #f8f9ff 0%, #f3f4f6 100%);
            border-left: 5px solid var(--accent);
            padding: 16px 16px;
            margin-bottom: 14px;
            font-size: 1.02rem;
            border-radius: 10px;
            line-height: 1.8;
            box-shadow: var(--shadow);
            transition: transform 0.3s, box-shadow 0.3s;
        }
        .step-box:hover {
            transform: translateX(2px);
            box-shadow: 0 6px 28px rgba(0,0,0,0.12);
        }
        .step-title {
            font-weight: 800;
            color: var(--text);
            display: block;
            margin-bottom: 10px;
            font-size: 1.12rem;
            letter-spacing: 0.3px;
        }
        .final-result {
            text-align: center;
            background: linear-gradient(135deg, #e0f7fa 0%, #f0f4ff 100%);
            border: 2px solid var(--accent-2);
            padding: 28px 16px 24px 16px;
            border-radius: 16px;
            margin-top: 2.5rem;
            box-shadow: var(--shadow);
            transition: transform 0.3s, box-shadow 0.3s;
        }
        .final-result:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 32px rgba(45, 212, 191, 0.2);
        }
        .result-label {
            font-size: 1.01rem;
            color: #3b3b5c;
            margin-bottom: 10px;
            font-weight: 700;
        }
        .big-number {
            font-size: 2.5rem;
            font-weight: 900;
            color: var(--accent);
            font-family: 'Courier New', Courier, monospace;
            letter-spacing: 1px;
            margin: 20px 0;
            text-shadow: 0 4px 15px rgba(88, 68, 221, 0.15);
            animation: scaleIn 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
            word-wrap: break-word;
        }
        @keyframes scaleIn {
            from { opacity: 0; transform: scale(0.9); }
            to { opacity: 1; transform: scale(1); }
        }
        .bar-notation {
            text-decoration: overline;
            text-decoration-thickness: 2px;
            text-underline-offset: 3px;
        }
        .decimal-result {
            margin-top: 15px;
            font-size: 1.01rem;
            color: #3b3b5c;
            border-top: 1px dashed #48c6ef;
            padding-top: 12px;
        }
        .decimal-value {
            font-weight: bold;
            color: #3b3b5c;
            font-family: 'Courier New', Courier, monospace;
            font-size: 1.15rem;
        }
        .note {
            font-size: 0.95rem;
            color: #6c63ff;
            text-align: center;
            margin-top: 15px;
            padding: 10px;
            background-color: #f8fafc;
            border-radius: 7px;
            border-left: 4px solid #48c6ef;
        }
        .info-box {
            background-color: #fff3cd;
            border-left: 5px solid #ffc107;
            padding: 13px 12px;
            margin-top: 15px;
            border-radius: 7px;
            font-size: 0.97rem;
            color: #856404;
            box-shadow: 0 2px 8px rgba(255,193,7,0.07);
        }
        /* Dark mode */
        body.dark {
            --bg: linear-gradient(135deg, #0f172a 0%, #1a1f35 50%, #16213e 100%);
            --card-bg: #0f172a;
            --accent: #a78bfa;
            --accent-2: #2dd4bf;
            --accent-3: #fb923c;
            --text: #f1f5f9;
            --text-light: #cbd5e1;
            --border: #334155;
        }
        body.dark .container { box-shadow: var(--shadow-lg); border: 1px solid var(--border); }
        body.dark .step-box { background: linear-gradient(90deg, #1e293b 0%, #1a1f35 100%); border-left-color: var(--accent); box-shadow: none; border: 1px solid var(--border); }
        body.dark input { background: #1a1f35; border-color: var(--border); color:var(--text); }
        body.dark .procedure-area { background: #1e293b; border-left-color: var(--accent-2); border: 1px solid var(--border); }
        body.dark .final-result { background: linear-gradient(120deg, #1e293b 0%, #1a1f35 100%); border-color: var(--accent-2); box-shadow: none; border: 1px solid var(--border); }
        body.dark .big-number { color: var(--accent); text-shadow: 0 0 20px rgba(167,139,250,0.3); }
        body.dark .table-container { background: #1e293b; border: 1px solid var(--border); }
        body.dark .table-row-highlight { background: linear-gradient(90deg, #2dd4bf, #2dd4bf) !important; color: #0f172a !important; }
        .show-procedure {
            display: flex;
            align-items: center;
            gap: 8px;
            margin: 18px 0 0 0;
        }
        .show-procedure input[type="checkbox"] {
            accent-color: #6c63ff;
            width: 20px;
            height: 20px;
        }
        .procedure-area {
            margin-top: 18px;
            background: linear-gradient(135deg, #f8f9ff 0%, #f3f4f6 100%);
            border-radius: 12px;
            padding: 18px 16px;
            box-shadow: var(--shadow);
            border-left: 5px solid var(--accent-2);
            border: 1px solid var(--border);
            font-size: 1.02rem;
            color: var(--text);
            line-height: 1.8;
        }
        .table-container {
            margin-top: 20px;
            background: #f8f9fa;
            border-radius: 12px;
            padding: 16px;
            border: 1px solid var(--border);
            box-shadow: var(--shadow);
            max-height: 400px;
            overflow-y: auto;
            font-family: 'Courier New', monospace;
        }
        .table-container table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.95rem;
        }
        .table-container th {
            background: linear-gradient(135deg, var(--accent), var(--accent-2));
            color: white;
            padding: 10px 8px;
            text-align: center;
            font-weight: 700;
            position: sticky;
            top: 0;
            z-index: 10;
        }
        .table-container td {
            padding: 8px 10px;
            text-align: center;
            border-bottom: 1px solid rgba(0,0,0,0.04);
            color: var(--text);
        }
        .table-container tr:hover {
            background: rgba(88,68,221,0.08);
        }
        .table-row-highlight {
            background: linear-gradient(90deg, var(--accent-2), rgba(45,212,191,0.5)) !important;
            color: var(--text) !important;
            font-weight: 700;
            box-shadow: inset 0 0 0 2px var(--accent-2);
        }
        .note {
            margin-top: 20px;
            padding: 14px 16px;
            background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
            border-radius: 10px;
            border-left: 5px solid #f59e0b;
            border: 1px solid rgba(245,158,11,0.3);
            color: #78350f;
            font-size: 0.98rem;
            box-shadow: 0 2px 6px rgba(245,158,11,0.1);
        }
        .info-box {
            margin-top: 16px;
            padding: 12px 14px;
            background: linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%);
            border-radius: 10px;
            border-left: 5px solid #3b82f6;
            border: 1px solid rgba(59,130,246,0.3);
            color: #1e3a8a;
            font-size: 0.96rem;
            box-shadow: 0 2px 6px rgba(59,130,246,0.1);
        }
        .show-procedure {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-top: 16px;
            cursor: pointer;
        }
        .show-procedure input[type="checkbox"] {
            width: 20px;
            height: 20px;
            cursor: pointer;
            accent-color: var(--accent);
        }
        .show-procedure label {
            cursor: pointer;
            color: var(--text);
            font-size: 1.01rem;
            font-weight: 500;
        }
        body.dark .note {
            background: linear-gradient(135deg, #7c2d12 0%, #9a3412 100%);
            border-left-color: #fb923c;
            border-color: rgba(251,146,60,0.2);
            color: #fed7aa;
        }
        body.dark .info-box {
            background: linear-gradient(135deg, #0c4a6e 0%, #164e63 100%);
            border-left-color: #0ea5e9;
            border-color: rgba(14,165,233,0.2);
            color: #cffafe;
        }
        body.dark .table-container {
            background: #1a1f35;
            border-color: var(--border);
        }
        body.dark .table-container td {
            color: #cbd5e1;
            border-bottom-color: rgba(148,163,184,0.1);
        }
        body.dark .table-container tr:hover {
            background: rgba(167,139,250,0.1);
        }
        body.dark .procedure-area {
            background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%);
            border-left-color: var(--accent-2);
            border-color: var(--border);
        }
        input[type="radio"],
        #darkMode {
            width: auto;
            padding: 0;
            border: none;
            margin-right: 6px;
            cursor: pointer;
            accent-color: var(--accent);
            width: 18px;
            height: 18px;
        }
        input[type="radio"]:hover,
        #darkMode:hover {
            filter: brightness(1.1);
        }
        input[type="radio"]:focus,
        #darkMode:focus {
            outline: 2px solid var(--accent);
            outline-offset: 2px;
        }
        @media (max-width: 600px) {
            .container {
                padding: 2rem 1.5rem;
                border-radius: 16px;
                margin-top: 1rem;
                margin-bottom: 2rem;
            }
            h1 {
                font-size: 1.8rem;
            }
            button {
                font-size: 1rem;
                padding: 12px;
            }
            .big-number {
                font-size: 1.8rem;
            }
            input {
                font-size: 1rem;
                padding: 12px 14px;
            }
            .table-container {
                max-height: 300px;
            }
        }
        /* Procedural example styles */
        .procedure-example {
            margin-top: 8px;
            padding: 12px;
            border-radius: 10px;
            background: var(--card-bg);
            border: 1px solid var(--border);
            box-shadow: var(--shadow);
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        .procedure-example-title {
            font-weight: 700;
            color: var(--accent);
            font-size: 0.95rem;
        }
        .procedure-example-table {
            width: 100%;
            border-collapse: collapse;
            font-family: 'Courier New', monospace;
            font-size: 0.95rem;
        }
        .procedure-example-table th {
            padding: 8px 6px;
            text-align: center;
            color: #fff;
            background: linear-gradient(90deg, var(--accent), var(--accent-2));
            font-weight: 700;
        }
        .procedure-example-table td {
            padding: 8px 6px;
            text-align: center;
            border-bottom: 1px solid rgba(0,0,0,0.04);
            color: var(--text);
        }
        .procedure-row-highlight {
            background: linear-gradient(90deg, var(--accent), var(--accent-2));
            color: #fff !important;
            font-weight: 700;
            box-shadow: inset 0 0 0 2px rgba(255,255,255,0.03);
        }
        .procedure-row-highlight td {
            color: #fff !important;
        }
        .procedure-example .example-legend {
            font-size: 0.92rem;
            color: var(--text-light);
            display:flex;
            justify-content:space-between;
            align-items:center;
            gap: 10px;
        }
        body.dark .procedure-example {
            background: linear-gradient(135deg,#0f172a 0%, #111827 100%);
            border-color: rgba(255,255,255,0.04);
        }
        body.dark .procedure-example-table td { color: #cbd5e1; }
        body.dark .procedure-row-highlight { box-shadow: inset 0 0 0 2px rgba(255,255,255,0.06); }
        .visually-hidden { position: absolute !important; width: 1px; height: 1px; padding: 0; margin: -1px; overflow: hidden; clip: rect(0 0 0 0); white-space: nowrap; border: 0; }
    </style>
</head>
<body>

<div class="container">
    <h1>üßÆ Calculadora</h1>
    <p class="subtitle" id="main-subtitle">Logaritmos (Base 10) y Antilogaritmos</p>
    
    <div class="input-group">
        <label for="numberInput" id="inputLabel">Ingresa un n√∫mero (N > 0):</label>
        <span id="inputHelper" style="display:block;font-size:0.95em;color:var(--text-light);margin-bottom:0.5em;">Ejemplo: 0.001349, 134.9, 5, 0.5, 1000</span>
        <input type="number" id="numberInput" placeholder="Ej: 134.9" step="any">
        
        <div class="show-procedure">
            <input type="checkbox" id="showProcedure">
            <label for="showProcedure" style="margin:0; font-weight:600; color:var(--accent); cursor:pointer;">üìã Mostrar procedimiento manual de tabla</label>
        </div>
    </div>
    
    <div style="display:flex;gap:16px;margin-bottom:14px;align-items:center;flex-wrap:wrap;">
        <div style="display:flex;gap:10px;align-items:center;">
            <label style="display:flex;align-items:center;gap:6px;font-weight:700;color:var(--text);margin:0;">Modo:</label>
            <label style="cursor:pointer;display:flex;align-items:center;gap:6px;color:var(--text);">
                <input type="radio" name="mode" value="log" checked> Logaritmo
            </label>
            <label style="cursor:pointer;display:flex;align-items:center;gap:6px;color:var(--text);">
                <input type="radio" name="mode" value="antilog"> Antilogaritmo
            </label>
        </div>
        <div style="margin-left:auto;display:flex;align-items:center;gap:10px;">
            <label for="darkMode" style="font-weight:600;color:var(--text);margin:0;cursor:pointer;display:flex;align-items:center;gap:6px;">
                üåô Modo nocturno
            </label>
            <input type="checkbox" id="darkMode">
        </div>
    </div>

    <button onclick="calculate()" id="computeBtn">Calcular</button>
    <span style="display:block;text-align:center;color:#48c6ef;font-size:0.98em;margin-top:0.7em;">Presiona <b>Enter</b> para calcular r√°pidamente</span>

    <div id="result-area">
        <div class="step-box" aria-live="polite">
            <span class="step-title" id="step1-title">üìç Paso 1: Caracter√≠stica</span>
            <div id="step1-text"></div>
        </div>

        <div class="step-box" aria-live="polite">
            <span class="step-title" id="step2-title">üìä Paso 2: Mantisa</span>
            <div id="step2-text"></div>
        </div>

        <div id="procedure-area" class="procedure-area" style="display:none;"></div>

        <div class="step-box" style="margin-top:12px;">
            <span class="step-title" id="table-sim-title">üîé Simulaci√≥n de Tabla</span>
            <div id="table-sim" style="font-family:'Courier New',monospace; font-size:0.98rem; color:var(--text); margin-top:12px;"></div>
        </div>

        <div class="final-result">
            <div class="result-label" id="result-label-main">Resultado Final</div>
            <div class="big-number" id="final-display" aria-label="Resultado"></div>
            <div class="decimal-result">
                Equivalente decimal: <span class="decimal-value" id="decimal-display" aria-label="Resultado decimal"></span>
            </div>
        </div>
        
        <div class="info-box" id="info-box-content">
            <!-- Din√°mico -->
        </div>
    </div>
</div>

<script>
    const LOG_MODE = 'log';
    const ANTILOG_MODE = 'antilog';

    // UI Updates based on mode
    function updateUIForMode() {
        const mode = document.querySelector('input[name="mode"]:checked').value;
        const inputLabel = document.getElementById('inputLabel');
        const inputHelper = document.getElementById('inputHelper');
        const numberInput = document.getElementById('numberInput');
        const resultArea = document.getElementById('result-area');

        // Limpiar resultados al cambiar modo
        resultArea.style.display = 'none';
        numberInput.value = '';

        if (mode === LOG_MODE) {
            inputLabel.textContent = "Ingresa un n√∫mero (N > 0):";
            inputHelper.textContent = "Ejemplo: 0.001349, 134.9, 5, 0.5";
            numberInput.placeholder = "Ej: 134.9";
            document.getElementById('main-subtitle').textContent = "Calcular Logaritmo (Base 10)";
        } else {
            inputLabel.textContent = "Ingresa el logaritmo (L):";
            inputHelper.textContent = "Puede ser positivo o negativo (ej: 2.13, -1.5, 0.45)";
            numberInput.placeholder = "Ej: 2.1303";
            document.getElementById('main-subtitle').textContent = "Calcular Antilogaritmo (Encontrar n√∫mero)";
        }
    }

    function createMiniTable(targetNumStr, targetMantissaStr, mode) {
        // Genera HTML para la simulaci√≥n de tabla
        let rows = [];
        let highlightKey = "";
        
        if (mode === LOG_MODE) {
            // Tabla Log: Filas son N√∫meros (10-99), Contenido son Mantisas
            // Usamos los primeros d√≠gitos de targetNumStr para simular filas
            let key = parseInt(targetNumStr.substring(0, 4)); // Digitos significativos
            if (isNaN(key)) key = 1000;
            
            highlightKey = String(key).padStart(4, '0');

            for (let i = -2; i <= 2; i++) {
                let currentKey = key + i;
                if (currentKey < 1000) continue;
                let s = String(currentKey).padStart(4, '0');
                let nval = Number(s[0] + '.' + s.substring(1));
                let m = Math.log10(nval).toFixed(4).substring(1); // .XXXX
                rows.push({ k: s, val: m });
            }
        } else {
            // Tabla Antilog (usualmente): Filas son Mantisas (.00 - .99), Contenido son Digitos
            // Simulamos: Fila = Mantisa aproximada, Contenido = D√≠gitos del n√∫mero
            // targetMantissaStr es "XXXX" (ej: "3010")
            let mantVal = parseInt(targetMantissaStr, 10);
            
            // Queremos mostrar mantisas alrededor de la nuestra
            for (let i = -2; i <= 2; i++) {
                let currentMant = mantVal + i;
                if (currentMant < 0) continue;
                
                let mantStr = String(currentMant).padStart(4, '0');
                // Calcular qu√© n√∫mero produce esta mantisa: 10^(0.mantStr)
                let mFloat = parseFloat("0." + mantStr);
                let num = Math.pow(10, mFloat);
                
                // Los d√≠gitos del n√∫mero resultante (ej: 2000 para .3010)
                // Normalizamos para mostrar 4 d√≠gitos (ej: 1.005 -> 1005)
                let digits = num.toFixed(5).replace('.','').substring(0,4);
                
                rows.push({ k: "." + mantStr, val: digits });
            }
            highlightKey = "." + targetMantissaStr;
        }

        let html = `<table class="procedure-example-table">
            <thead><tr><th>${mode === LOG_MODE ? 'N√∫mero (N)' : 'Mantisa'}</th><th>${mode === LOG_MODE ? 'Mantisa' : 'D√≠gitos de N'}</th></tr></thead>
            <tbody>`;
            
        rows.forEach(row => {
            const isMatch = row.k === highlightKey;
            const style = isMatch ? 'class="procedure-row-highlight"' : '';
            html += `<tr ${style}><td>${row.k}</td><td>${row.val}</td></tr>`;
        });
        
        html += `</tbody></table>`;
        if(mode === LOG_MODE) {
            html += `<div class="example-legend" style="margin-top:5px"><small>Buscamos los d√≠gitos ${highlightKey} ‚Üí Encontramos mantisa .${targetMantissaStr}</small></div>`;
        } else {
            html += `<div class="example-legend" style="margin-top:5px"><small>Buscamos mantisa ${highlightKey} ‚Üí Encontramos d√≠gitos ${rows.find(r=>r.k===highlightKey)?.val}</small></div>`;
        }
        
        return html;
    }

    function calculate() {
        const inputStr = document.getElementById('numberInput').value.trim();
        const mode = document.querySelector('input[name="mode"]:checked').value;
        const n = parseFloat(inputStr);
        const resultArea = document.getElementById('result-area');
        const showProc = document.getElementById('showProcedure').checked;

        // Reset areas
        document.getElementById('step1-text').innerHTML = "";
        document.getElementById('step2-text').innerHTML = "";
        document.getElementById('procedure-area').style.display = 'none';
        document.getElementById('final-display').innerHTML = "";
        document.getElementById('table-sim').innerHTML = "";

        if (isNaN(n)) {
            alert("Por favor ingresa un n√∫mero v√°lido.");
            resultArea.style.display = 'none';
            return;
        }

        if (mode === LOG_MODE) {
            calculateLogarithm(n, inputStr, showProc);
        } else {
            calculateAntilogarithm(n, showProc);
        }
        resultArea.style.display = 'block';
    }

    function calculateLogarithm(n, inputStr, showProc) {
        if (n <= 0) {
            alert("El logaritmo solo est√° definido para n√∫meros positivos.");
            document.getElementById('result-area').style.display = 'none';
            return;
        }

        const logVal = Math.log10(n);
        let charVal, mantVal;
        let step1HTML = "";

        // Paso 1: Caracter√≠stica
        if (n >= 1) {
            // Parte entera
            let intPart = String(Math.floor(n));
            if (inputStr.toLowerCase().includes('e')) {
                // Manejo b√°sico de notaci√≥n cient√≠fica para contar d√≠gitos
                const [base, exp] = inputStr.toLowerCase().split('e');
                // Aproximaci√≥n r√°pida para la demo
                intPart = "1".padEnd(parseInt(exp)+1, '0'); // Dummy visualization for magnitude
                step1HTML = `El n√∫mero est√° en notaci√≥n cient√≠fica. Exponente aproximado determina d√≠gitos.<br>
                             D√≠gitos enteros estimados: <b>${parseInt(exp)+1}</b>.<br>
                             Caracter√≠stica = D√≠gitos - 1 = <b>${parseInt(exp)}</b>`;
                charVal = parseInt(exp);
            } else {
                const digits = intPart.length;
                charVal = digits - 1;
                step1HTML = `El n√∫mero es ‚â• 1. Tiene <b>${digits}</b> d√≠gito(s) en la parte entera (${intPart}).<br>
                             F√≥rmula: (D√≠gitos - 1) ‚Üí ${digits} - 1 = <b>${charVal}</b>`;
            }
        } else {
            // Menor que 1
            let zeros = 0;
            // Hack simple para contar ceros post-punto decimal
            const decimalPart = inputStr.split('.')[1] || "";
            for (let char of decimalPart) {
                if (char === '0') zeros++;
                else break;
            }
            charVal = -(zeros + 1); // -1, -2, etc.
            step1HTML = `El n√∫mero es < 1. Hay <b>${zeros}</b> cero(s) despu√©s del punto decimal antes de la primera cifra.<br>
                         F√≥rmula: -(Ceros + 1) ‚Üí -(${zeros} + 1) = <b>${charVal}</b> (o barra ${Math.abs(charVal)})`;
        }

        // Paso 2: Mantisa
        mantVal = logVal - charVal; 
        // Asegurar precisi√≥n de flotante
        let mantStr = mantVal.toFixed(4).substring(1); // .XXXX

        // Digitos significativos para la "tabla"
        let cleanStr = inputStr.replace('.','').replace(/^0+/,'');
        if (cleanStr.length > 4) cleanStr = cleanStr.substring(0,4);
        while(cleanStr.length < 4) cleanStr += '0';

        document.getElementById('step1-title').innerText = "üìç Paso 1: Caracter√≠stica (Posici√≥n del punto)";
        document.getElementById('step1-text').innerHTML = step1HTML;

        document.getElementById('step2-title').innerText = "üìä Paso 2: Mantisa (Secuencia de d√≠gitos)";
        document.getElementById('step2-text').innerHTML = `
            Buscamos la secuencia de d√≠gitos significativos <b>${cleanStr}</b> en la tabla.<br>
            La tabla nos da la mantisa: <b>${mantStr}</b>`;

        // Simulaci√≥n Tabla
        document.getElementById('table-sim').innerHTML = createMiniTable(cleanStr, mantStr.substring(1), LOG_MODE);

        // Procedimiento
        if (showProc) {
            const procHTML = `
                <b>Procedimiento Manual:</b><br>
                1. Contar d√≠gitos o ceros para la caracter√≠stica: <b>${charVal}</b>.<br>
                2. Ignorar el punto decimal, buscar <b>${cleanStr.substring(0,2)}</b> en la primera columna de la tabla.<br>
                3. Desplazarse a la columna <b>${cleanStr[2]}</b>.<br>
                4. El valor de intersecci√≥n es la mantisa <b>${mantStr}</b>.
            `;
            document.getElementById('procedure-area').innerHTML = procHTML;
            document.getElementById('procedure-area').style.display = 'block';
        }

        // Resultado Final
        let displayHTML = "";
        if (charVal < 0) {
            displayHTML = `<span class="bar-notation">${Math.abs(charVal)}</span>${mantStr}`;
        } else {
            displayHTML = `${charVal}${mantStr}`;
        }
        
        document.getElementById('result-label-main').innerText = "Resultado (Logaritmo)";
        document.getElementById('final-display').innerHTML = displayHTML;
        document.getElementById('decimal-display').innerText = logVal.toFixed(5);
        document.getElementById('info-box-content').innerHTML = `
            <strong>‚ÑπÔ∏è Lectura:</strong> <span class="bar-notation">2</span>${mantStr} significa -2 + ${mantStr} = -${Math.abs(-2 + parseFloat(mantStr)).toFixed(4)}
        `;
    }

    function calculateAntilogarithm(L, showProc) {
        // L es el logaritmo total (ej: 2.3010 o -1.5)
        // Paso 1: Separar Caracter√≠stica y Mantisa
        // MATEM√ÅTICAMENTE: Mantisa siempre debe ser positiva [0, 1)
        
        let charVal = Math.floor(L);
        let mantVal = L - charVal;
        
        // Correcci√≥n de punto flotante
        mantVal = parseFloat(mantVal.toFixed(5));
        let mantStr = mantVal.toFixed(4).substring(1); // .XXXX
        
        // Si el n√∫mero era entero exacto (ej 2.0), mantisa 0
        if (mantVal === 1) { // Caso borde flotante
            charVal += 1;
            mantVal = 0;
            mantStr = ".0000";
        }

        const realNumber = Math.pow(10, L);
        
        // Generar digitos a partir de la mantisa para la "tabla"
        // 10^mantisa nos da los d√≠gitos (ej 10^0.3010 = 1.999...)
        let digitsRaw = Math.pow(10, mantVal);
        let digitsStr = digitsRaw.toFixed(4).replace('.','').substring(0,4);

        document.getElementById('step1-title').innerText = "üìç Paso 1: Separar (C y M)";
        let step1Explanation = `El valor ingresado es <b>${L}</b>.<br>`;
        if (L < 0) {
            step1Explanation += `‚ö†Ô∏è Al ser negativo, usamos el suelo (floor) para la caracter√≠stica y aseguramos mantisa positiva.<br>
            Caracter√≠stica = floor(${L}) = <b>${charVal}</b>.<br>
            Mantisa = ${L} - (${charVal}) = <b>${mantStr}</b>.`;
        } else {
            step1Explanation += `Caracter√≠stica (parte entera) = <b>${charVal}</b>.<br>
            Mantisa (parte decimal) = <b>${mantStr}</b>.`;
        }
        document.getElementById('step1-text').innerHTML = step1Explanation;

        document.getElementById('step2-title').innerText = "üìä Paso 2: Buscar en Tabla Inversa";
        document.getElementById('step2-text').innerHTML = `
            Buscamos la mantisa <b>${mantStr}</b> DENTRO del cuerpo de la tabla.<br>
            Encontramos que corresponde a la secuencia de d√≠gitos: <b>${digitsStr}</b>.`;

        // Simulaci√≥n Tabla (Modo Antilog: buscamos mantisa, obtenemos digitos)
        document.getElementById('table-sim').innerHTML = createMiniTable(null, mantStr.substring(1), ANTILOG_MODE);

        // Procedimiento
        if (showProc) {
            const procHTML = `
                <b>Procedimiento Manual:</b><br>
                1. Ubicar la mantisa <b>${mantStr}</b> en el cuerpo de la tabla.<br>
                2. Mirar a los extremos para encontrar los d√≠gitos correspondientes (<b>${digitsStr}</b>).<br>
                3. Usar la caracter√≠stica <b>${charVal}</b> para colocar el punto decimal.<br>
                Si C=${charVal}, movemos el punto ${charVal >= 0 ? charVal + 1 : 'hacia la izquierda'} posiciones.
            `;
            document.getElementById('procedure-area').innerHTML = procHTML;
            document.getElementById('procedure-area').style.display = 'block';
        }

        // Resultado Final
        document.getElementById('result-label-main').innerText = "Resultado (N√∫mero Original)";
        // Formateo bonito del numero final
        let finalFormat = realNumber.toPrecision(5).replace(/\.?0+$/,""); // Quitar ceros extra si no es cient√≠fico
        if(Math.abs(L) > 6) finalFormat = realNumber.toExponential(4);

        document.getElementById('final-display').innerHTML = finalFormat;
        document.getElementById('decimal-display').innerText = "N = 10^" + L;
        
        document.getElementById('info-box-content').innerHTML = `
            <strong>‚ÑπÔ∏è L√≥gica:</strong> Los d√≠gitos vienen de la Mantisa, la posici√≥n del punto viene de la Caracter√≠stica.
        `;
    }

    // Event Listeners
    document.addEventListener('DOMContentLoaded', function() {
        // Change text on radio switch
        document.querySelectorAll('input[name="mode"]').forEach(radio => {
            radio.addEventListener('change', updateUIForMode);
        });

        document.getElementById('numberInput').addEventListener('keydown', function(event) {
            if (event.key === 'Enter') {
                event.preventDefault();
                calculate();
            }
        });

        document.getElementById('showProcedure').addEventListener('change', function() {
            if (document.getElementById('result-area').style.display !== 'none') {
                calculate(); // Recalcular para mostrar/ocultar proc
            }
        });

        document.getElementById('darkMode').addEventListener('change', function(e){
            if (this.checked) document.body.classList.add('dark'); 
            else document.body.classList.remove('dark');
        });
    });
</script>

</body>
</html>